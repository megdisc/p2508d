<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>工賃評価一覧 - p2508d</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="mockup-container">
        <header class="header">
            <div>
                <h1 class="header-logo"><a href="dashboard.html">p2508d</a></h1>
            </div>

            <nav class="nav" id="side-nav">
                <ul class="nav-list">
                    <li><a href="dashboard.html" class="nav-link">ダッシュボード</a></li>
                    <li><a href="daily_records.html" class="nav-link">日々の記録</a></li>
                    <li><a href="members_menu.html" class="nav-link">利用者支援</a></li>
                    <li><a href="staff_menu.html" class="nav-link">施設と職員</a></li>
                    <li><a href="work_activities_menu.html" class="nav-link">生産活動</a></li>
                    <li><a href="accounting_menu.html" class="nav-link active">会計</a></li>
                    <li><a href="claims.html" class="nav-link">国保連請求</a></li>
                    <li><a href="analytics.html" class="nav-link">データ分析</a></li>
                    <li><a href="settings.html" class="nav-link">設定</a></li>
                    <li><a href="my_page.html" class="nav-link">マイページ</a></li>
                </ul>
                <div class="nav-logout-section">
                    <a href="index.html" class="nav-link">ログアウト</a>
                </div>
            </nav>
            </header>

        <main class="mockup-main">

            <div id="wage-evaluation-list" class="mockup-page active">
                <div class="list-page-header">
                    <h1 class="page-title">工賃評価一覧</h1>
                     <div>
                        <a href="accounting_menu.html" class="button button-secondary" style="margin-right: 0.5rem;">会計メニューへ</a>
                        </div>
                </div>
                <div class="section">
                    <form class="section-content filter-form-inline" style="margin-bottom: 1.5rem;">
                        <div class="form-group" style="flex-grow: 2;">
                            <label for="search-wage-member-name" class="form-label">利用者名</label>
                            <input type="text" id="search-wage-member-name" class="form-control" placeholder="氏名で検索...">
                        </div>
                        <div class="form-group">
                            <label for="filter-wage-rank" class="form-label">工賃等級</label>
                            <select id="filter-wage-rank" class="form-control">
                                <option value="">すべて</option>
                                <option value="A等級">A等級</option>
                                <option value="B等級">B等級</option>
                                <option value="C等級">C等級</option>
                            </select>
                        </div>
                        <button type="button" class="button button-secondary">クリア</button>
                    </form>
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>利用者名</th>
                                    <th>工賃等級</th>
                                    <th class="col-amount">基本工賃(円)</th>
                                    <th>評価メモ</th>
                                    <th>最終更新日</th>
                                </tr>
                            </thead>
                            <tbody id="member-wage-list-tbody">
                                <tr class="clickable-row"
                                    data-member-name="青木 誠"
                                    data-wage-rank="A等級"
                                    data-base-wage="350"
                                    data-memo="作業スピードが安定している。"
                                    data-updated-date="2025-10-20">
                                    <td>青木 誠</td>
                                    <td>A等級</td>
                                    <td class="col-amount">350</td>
                                    <td class="col-memo" title="作業スピードが安定している。">作業スピードが安定している。</td>
                                    <td>2025/10/20</td>
                                </tr>
                                <tr class="clickable-row"
                                    data-member-name="五十嵐 直人"
                                    data-wage-rank="B等級"
                                    data-base-wage="300"
                                    data-memo="複雑な作業はまだ支援が必要。"
                                    data-updated-date="2025-10-18">
                                    <td>五十嵐 直人</td>
                                    <td>B等級</td>
                                    <td class="col-amount">300</td>
                                    <td class="col-memo" title="複雑な作業はまだ支援が必要。">複雑な作業はまだ支援が必要。</td>
                                    <td>2025/10/18</td>
                                </tr>
                                 <tr class="clickable-row"
                                    data-member-name="遠藤 雅彦"
                                    data-wage-rank="B等級"
                                    data-base-wage="300"
                                    data-memo=""
                                    data-updated-date="2025-10-18">
                                    <td>遠藤 雅彦</td>
                                    <td>B等級</td>
                                    <td class="col-amount">300</td>
                                    <td class="col-memo"></td>
                                    <td>2025/10/18</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="edit-member-wage-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">工賃評価編集</h2>
                <span class="modal-close" onclick="closeModal('edit-member-wage-modal')">&times;</span>
            </div>
            <div class="modal-body">
                <p><strong>利用者:</strong> <span id="modal-wage-member-name"></span></p>

                <div class="form-group">
                    <label for="modal-wage-rank" class="form-label">工賃等級</label>
                    <select id="modal-wage-rank" class="form-control">
                         <option value="A等級">A等級</option>
                         <option value="B等級">B等級</option>
                         <option value="C等級">C等級</option>
                    </select>
                </div>
                 <div class="form-group">
                    <label for="modal-wage-memo" class="form-label">評価メモ</label>
                    <textarea id="modal-wage-memo" class="form-control" rows="4"></textarea>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="button button-secondary" onclick="closeModal('edit-member-wage-modal')">キャンセル</button>
                <button type="button" class="button button-primary">保存</button>
            </div>
        </div>
    </div>
    <script src="script.js"></script>

    <script>
        // 工賃一覧の簡易フィルタリング関数
        function filterWages() {
            const nameInput = document.getElementById('search-wage-member-name');
            const rankSelect = document.getElementById('filter-wage-rank');
            // const monthInput = document.getElementById('filter-wage-month'); // 対象年月フィルタは残す場合
            const tableBody = document.getElementById('member-wage-list-tbody');

            if (!nameInput || !rankSelect /*|| !monthInput*/ || !tableBody) {
                return;
            }

            const nameFilter = nameInput.value.toLowerCase();
            const rankFilter = rankSelect.value;
            // const monthFilter = monthInput.value; // "YYYY-MM" format
            const rows = tableBody.getElementsByTagName('tr');

            Array.from(rows).forEach(row => {
                const memberName = row.dataset.memberName?.toLowerCase() || '';
                const rankData = row.dataset.wageRank || '';
                // const monthData = row.dataset.month || ''; // "YYYY-MM" format

                const nameMatch = memberName.includes(nameFilter);
                const rankMatch = rankFilter === "" || rankData === rankFilter;
                // const monthMatch = monthFilter === "" || monthData === monthFilter;

                if (nameMatch && rankMatch) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            // --- 工賃一覧: フィルタリングのイベントリスナー設定 ---
            if (typeof window.filterWages === 'function') {
                const nameInputListener = document.getElementById('search-wage-member-name');
                const rankSelectListener = document.getElementById('filter-wage-rank');
                // const monthInputListener = document.getElementById('filter-wage-month');
                const clearButton = document.querySelector('#wage-evaluation-list .filter-form-inline .button-secondary');

                if(nameInputListener) nameInputListener.addEventListener('input', filterWages);
                if(rankSelectListener) rankSelectListener.addEventListener('change', filterWages);
                // if(monthInputListener) monthInputListener.addEventListener('change', filterWages);

                if(clearButton) {
                    clearButton.addEventListener('click', () => {
                         const form = document.querySelector('#wage-evaluation-list .filter-form-inline');
                         if (form) {
                             form.reset();
                             // 月フィルタをリセットする場合
                             // const monthInputDefault = document.getElementById('filter-wage-month');
                             // if (monthInputDefault) { monthInputDefault.value = "2025-09"; }
                         }
                         filterWages();
                    });
                }
                filterWages(); // 初期表示
            }

            // --- 行クリックでモーダル表示 ---
            const tableBody = document.getElementById('member-wage-list-tbody');
            if (tableBody && typeof window.openModal === 'function') {
                tableBody.addEventListener('click', (e) => {
                    const clickedRow = e.target.closest('tr.clickable-row');
                    if (clickedRow) {
                        // モーダル内の要素を取得
                        const modalMemberName = document.getElementById('modal-wage-member-name');
                        const modalRankSelect = document.getElementById('modal-wage-rank');
                        const modalMemoTextarea = document.getElementById('modal-wage-memo');

                        // data属性から値を取得
                        const memberName = clickedRow.dataset.memberName;
                        const rank = clickedRow.dataset.wageRank;
                        const memo = clickedRow.dataset.memo;

                        // モーダルに値を設定
                        if (modalMemberName) modalMemberName.textContent = memberName || '';
                        if (modalRankSelect) modalRankSelect.value = rank || '';
                        if (modalMemoTextarea) modalMemoTextarea.value = memo || '';

                        // モーダルを開く
                        window.openModal('edit-member-wage-modal');
                    }
                });
            }
        });
    </script>
    </body>
</html>