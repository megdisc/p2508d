<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>p2508d - データ分析</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .filter-form-inline { display: flex; align-items: flex-end; gap: 1.5rem; flex-wrap: wrap; }
        .filter-form-inline .form-group { margin-bottom: 0; flex-grow: 1; }
        .filter-form-inline .button-secondary { margin-bottom: 0; height: calc(1.5em + 1rem + 2px); flex-shrink: 0; }
        .chart-placeholder { text-align: center; padding: 4rem 1rem; background-color: var(--color-hover-bg); border: 1px dashed var(--color-border); border-radius: var(--border-radius); color: var(--color-text-secondary); font-size: var(--font-size-sm); }
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem; }
        .kpi-card { border: 1px solid var(--color-border); border-radius: var(--border-radius); padding: 1rem 1.5rem; background-color: var(--color-surface); text-align: center; }
        .kpi-card h4 { font-size: var(--font-size-sm); font-weight: 500; color: var(--color-text-secondary); margin-bottom: 0.5rem; }
        .kpi-card p { font-size: 1.5rem; font-weight: bold; color: var(--color-primary); }
        .kpi-card .subtext { font-size: var(--font-size-xs); font-weight: normal; color: var(--color-text-secondary); }
        .col-number { text-align: right !important; }
        .detail-view { display: none; }
        .period-selector-section .section-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }
        .period-unit-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .period-unit-button {
            padding: 0.5rem 1rem;
            font-size: var(--font-size-sm);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            background-color: var(--color-surface);
            color: var(--color-text-primary);
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s, border-color 0.2s;
        }
        .period-unit-button:hover {
            background-color: var(--color-hover-bg);
        }
        .period-unit-button.active {
            background-color: var(--color-primary);
            color: var(--color-button-text);
            border-color: var(--color-primary);
            font-weight: 500;
        }
        .period-main-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            width: 100%;
            max-width: 500px;
        }
        .period-navigation-buttons .button {
            padding: 0.75rem;
            font-size: 1.2rem;
            line-height: 1;
        }
        .period-display {
            text-align: center;
            flex-grow: 1;
        }
        .period-display-label {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-bottom: 0.25rem;
        }
        .period-display-main {
            font-size: 2.2rem;
            font-weight: bold;
            color: var(--color-primary);
            line-height: 1.1;
        }
        .period-display-sub {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
            margin-top: 0.25rem;
        }
        .period-detail-selectors {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        .period-detail-selectors .form-control {
            width: auto;
            padding: 0.5rem 0.75rem;
        }
        .period-detail-selectors label {
            margin-bottom: 0;
            font-weight: normal;
            font-size: var(--font-size-sm);
        }
    </style>
</head>
<body>
    <div class="mockup-container">
        <header class="header">
            <div> <h1 class="header-logo"><a href="dashboard.html">p2508d</a></h1> </div>
            <nav class="nav" id="side-nav">
                <ul class="nav-list">
                    <li><a href="dashboard.html" class="nav-link">ダッシュボード</a></li>
                    <li><a href="daily_records.html" class="nav-link">日々の記録</a></li>
                    <li><a href="members_menu.html" class="nav-link">利用者支援</a></li>
                    <li><a href="work_activities_menu.html" class="nav-link">生産活動</a></li>
                    <li><a href="staff_menu.html" class="nav-link">施設と職員</a></li>
                    <li><a href="accounting_menu.html" class="nav-link">会計</a></li>
                    <li><a href="claims.html" class="nav-link">国保連請求</a></li>
                    <li><a href="analytics.html" class="nav-link active">データ分析</a></li>
                    <li><a href="settings.html" class="nav-link">設定</a></li>
                    <li><a href="my_page.html" class="nav-link">マイページ</a></li>
                </ul>
                <div class="nav-logout-section"> <a href="index.html" class="nav-link">ログアウト</a> </div>
            </nav>
        </header>

        <main class="mockup-main">
            <div id="analytics" class="mockup-page active">
                <div class="list-page-header">
                    <h1 class="page-title">データ分析</h1>
                </div>

                <div class="sub-nav">
                    <ul id="analytics-subnav">
                        <li><a href="#" class="sub-nav-item" data-tab="tab-financial-overview">財務状況</a></li>
                        <li><a href="#" class="sub-nav-item" data-tab="tab-welfare-service">福祉サービス活動</a></li>
                        <li><a href="#" class="sub-nav-item active" data-tab="tab-production">生産活動</a></li>
                    </ul>
                </div>
                <div class="tab-content-wrapper">

                    <div id="tab-financial-overview" class="tab-content">
                        <div class="section period-selector-section" style="margin-bottom: 1.5rem;">
                            <div class="section-content">
                                <div class="period-unit-buttons" data-target-tab="tab-financial-overview">
                                    <button class="period-unit-button" data-unit="monthly">月次</button>
                                    <button class="period-unit-button active" data-unit="yearly">年次</button>
                                    <button class="period-unit-button" data-unit="all">全期間</button>
                                </div>
                                <div class="period-main-selector">
                                    <div class="period-navigation-buttons">
                                        <button class="button button-secondary period-prev-button">‹</button>
                                    </div>
                                    <div class="period-display">
                                        <p class="period-display-label">事業年度</p>
                                        <p class="period-display-main" id="financial-period-display-main">2025年度</p>
                                        <p class="period-display-sub" id="financial-period-display-sub">2025年4月1日～2026年3月31日</p>
                                    </div>
                                    <div class="period-navigation-buttons">
                                        <button class="button button-secondary period-next-button">›</button>
                                    </div>
                                </div>
                                <div class="period-detail-selectors" id="financial-period-details">
                                    <label for="financial-year-select">年度:</label>
                                    <select id="financial-year-select" class="form-control period-year-select">
                                        <option value="2025" selected>2025年度</option>
                                        <option value="2024">2024年度</option>
                                        <option value="2023">2023年度</option>
                                    </select>
                                    <label for="financial-month-select" class="period-month-label" style="display: none; margin-left: 1rem;">月:</label>
                                    <select id="financial-month-select" class="form-control period-month-select" style="display: none;">
                                        <option value="4">4月</option> <option value="5">5月</option> <option value="6">6月</option>
                                        <option value="7">7月</option> <option value="8">8月</option> <option value="9">9月</option>
                                        <option value="10" selected>10月</option> <option value="11">11月</option> <option value="12">12月</option>
                                        <option value="1">1月</option> <option value="2">2月</option> <option value="3">3月</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="summary-view">
                            <div class="section">
                                <h2 class="section-title">主要指標</h2>
                                <div class="kpi-grid">
                                    <div class="kpi-card"> <h4>総売上</h4> <p>15,850,000 <span class="subtext">円</span></p> </div>
                                    <div class="kpi-card"> <h4>総支出</h4> <p>13,100,000 <span class="subtext">円</span></p> </div>
                                    <div class="kpi-card"> <h4>経常利益</h4> <p>2,750,000 <span class="subtext">円</span></p> </div>
                                    <div class="kpi-card"> <h4>利益率</h4> <p>17.3 <span class="subtext">%</span></p> </div>
                                </div>
                            </div>
                            <div class="section">
                                <div class="section-header">
                                    <h2 class="section-title-in-header">収支推移 (月次)</h2>
                                    <button class="button button-secondary" onclick="showDetailView('tab-financial-overview', true)">詳細を表示</button>
                                </div>
                                <div class="section-content">
                                    <div class="chart-placeholder">（売上・支出・利益の月次推移を示す棒グラフ/折れ線グラフ）</div>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 1.5rem;">
                                <div class="section">
                                     <h2 class="section-title">売上内訳</h2>
                                     <div class="section-content"> <div class="chart-placeholder">（訓練等給付費 / 生産活動収入 / その他 の円グラフ）</div> </div>
                                </div>
                                 <div class="section">
                                     <h2 class="section-title">支出内訳</h2>
                                     <div class="section-content"> <div class="chart-placeholder">（工賃 / 職員給与 / 地代家賃 / 水道光熱費 / その他 の円グラフ）</div> </div>
                                </div>
                            </div>
                        </div>
                        <div class="detail-view">
                            <div class="section">
                                <div class="section-header">
                                    <h2 class="section-title-in-header">月次収支明細</h2>
                                    <button class="button button-secondary" onclick="showDetailView('tab-financial-overview', false)">サマリーへ戻る</button>
                                </div>
                                <div class="table-wrapper">
                                    <table class="table" id="financial-monthly-detail-table">
                                        <thead> <tr> <th>月</th> <th class="col-number">売上(円)</th> <th class="col-number">支出(円)</th> <th class="col-number">利益(円)</th> <th class="col-number">利益率(%)</th> </tr> </thead>
                                        <tbody>
                                            <tr> <td>4月</td> <td class="col-number">1,500,000</td> <td class="col-number">1,200,000</td> <td class="col-number">300,000</td> <td class="col-number">20.0%</td> </tr>
                                            <tr> <td>5月</td> <td class="col-number">1,550,000</td> <td class="col-number">1,250,000</td> <td class="col-number">300,000</td> <td class="col-number">19.4%</td> </tr>
                                            <tr style="font-weight: bold; background-color: var(--color-hover-bg);"> <td>合計</td> <td class="col-number">15,850,000</td> <td class="col-number">13,100,000</td> <td class="col-number">2,750,000</td> <td class="col-number">17.3%</td> </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="tab-welfare-service" class="tab-content">
                         <div class="section period-selector-section" style="margin-bottom: 1.5rem;">
                            <div class="section-content">
                                <div class="period-unit-buttons" data-target-tab="tab-welfare-service">
                                    <button class="period-unit-button" data-unit="monthly">月次</button>
                                    <button class="period-unit-button active" data-unit="yearly">年次</button>
                                    <button class="period-unit-button" data-unit="all">全期間</button>
                                </div>
                                <div class="period-main-selector">
                                    <div class="period-navigation-buttons">
                                        <button class="button button-secondary period-prev-button">‹</button>
                                    </div>
                                    <div class="period-display">
                                        <p class="period-display-label">会計年度</p>
                                        <p class="period-display-main" id="welfare-service-period-display-main">2025年度</p>
                                        <p class="period-display-sub" id="welfare-service-period-display-sub">2025年4月1日～2026年3月31日</p>
                                    </div>
                                    <div class="period-navigation-buttons">
                                        <button class="button button-secondary period-next-button">›</button>
                                    </div>
                                </div>
                                <div class="period-detail-selectors" id="welfare-service-period-details">
                                    <label for="welfare-service-year-select">年度:</label>
                                    <select id="welfare-service-year-select" class="form-control period-year-select">
                                        <option value="2025" selected>2025年度</option>
                                        <option value="2024">2024年度</option>
                                        <option value="2023">2023年度</option>
                                    </select>
                                    <label for="welfare-service-month-select" class="period-month-label" style="display: none; margin-left: 1rem;">月:</label>
                                    <select id="welfare-service-month-select" class="form-control period-month-select" style="display: none;">
                                        <option value="4">4月</option> <option value="5">5月</option> <option value="6">6月</option>
                                        <option value="7">7月</option> <option value="8">8月</option> <option value="9">9月</option>
                                        <option value="10" selected>10月</option> <option value="11">11月</option> <option value="12">12月</option>
                                        <option value="1">1月</option> <option value="2">2月</option> <option value="3">3月</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="summary-view">
                            <div class="section">
                                <h2 class="section-title">主要指標</h2>
                                <div class="kpi-grid">
                                    <div class="kpi-card"> <h4>平均利用率</h4> <p>92.5 <span class="subtext">%</span></p> </div>
                                    <div class="kpi-card"> <h4>延べ利用日数</h4> <p>4,580 <span class="subtext">日</span></p> </div>
                                    <div class="kpi-card"> <h4>平均利用日数/人月</h4> <p>19.8 <span class="subtext">日</span></p> </div>
                                    <div class="kpi-card"> <h4>平均工賃 (月額)</h4> <p>16,800 <span class="subtext">円</span></p> </div>
                                    <div class="kpi-card"> <h4>目標工賃達成率</h4> <p>105.0 <span class="subtext">%</span></p> </div>
                                </div>
                            </div>
                            <div class="section">
                                <div class="section-header">
                                    <h2 class="section-title-in-header">利用率推移 (月次)</h2>
                                    <button class="button button-secondary" onclick="showDetailView('tab-welfare-service', true)">詳細を表示</button>
                                </div>
                                <div class="section-content"> <div class="chart-placeholder">（定員充足率または利用率の月次推移を示す折れ線グラフ）</div> </div>
                            </div>
                             <div class="section">
                                <h2 class="section-title">平均工賃推移 (月次)</h2>
                                <div class="section-content"> <div class="chart-placeholder">（平均工賃月額の推移を示す折れ線グラフまたは棒グラフ）</div> </div>
                            </div>
                            <div class="section">
                                <h2 class="section-title">利用者別 利用状況 サマリー</h2>
                                <form class="section-content filter-form-inline" style="margin-bottom: 1.5rem;">
                                    <div class="form-group" style="flex-grow: 2;"> <label for="search-welfare-member-name-summary" class="form-label">利用者名</label> <input type="text" id="search-welfare-member-name-summary" class="form-control" placeholder="氏名で検索..."> </div>
                                    <div class="form-group"> <label for="filter-welfare-status-summary" class="form-label">利用率</label> <select id="filter-welfare-status-summary" class="form-control"> <option value="">すべて</option> <option value="high">90%以上</option> <option value="medium">70%-90%</option> <option value="low">70%未満</option> </select> </div>
                                    <button type="button" class="button button-secondary">クリア</button>
                                </form>
                                <div class="table-wrapper">
                                    <table class="table">
                                        <thead> <tr> <th>利用者名</th> <th class="col-number">利用日数</th> <th class="col-number">欠席日数</th> <th class="col-number">利用率(%)</th> </tr> </thead>
                                        <tbody id="welfare-tbody-summary">
                                            <tr class="clickable-row" data-member-name="青木 誠" data-util-rate="100"> <td style="text-align: left;">青木 誠</td> <td class="col-number">22</td> <td class="col-number">0</td> <td class="col-number">100.0%</td> </tr>
                                            <tr class="clickable-row" data-member-name="五十嵐 直人" data-util-rate="90.9"> <td style="text-align: left;">五十嵐 直人</td> <td class="col-number">20</td> <td class="col-number">2</td> <td class="col-number">90.9%</td> </tr>
                                            <tr class="clickable-row" data-member-name="遠藤 雅彦" data-util-rate="68.2"> <td style="text-align: left;">遠藤 雅彦</td> <td class="col-number">15</td> <td class="col-number">7</td> <td class="col-number">68.2%</td> </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="detail-view">
                            <div class="section">
                                <div class="section-header">
                                     <h2 class="section-title-in-header">利用者別 月次利用状況</h2>
                                     <button class="button button-secondary" onclick="showDetailView('tab-welfare-service', false)">サマリーへ戻る</button>
                                </div>
                                 <form class="section-content filter-form-inline" style="margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--color-border);">
                                    <div class="form-group" style="flex-grow: 2;"> <label for="search-welfare-member-name-detail" class="form-label">利用者名</label> <input type="text" id="search-welfare-member-name-detail" class="form-control" placeholder="氏名で検索..."> </div>
                                    <button type="button" class="button button-secondary">クリア</button>
                                </form>
                                <div class="table-wrapper">
                                    <table class="table" id="welfare-monthly-detail-table">
                                        <thead> <tr> <th>利用者名</th> <th>4月</th><th>5月</th><th>6月</th><th>7月</th><th>8月</th><th>9月</th> <th>10月</th><th>11月</th><th>12月</th><th>1月</th><th>2月</th><th>3月</th> <th>年度計</th><th>年度平均(%)</th> </tr> </thead>
                                        <tbody id="welfare-monthly-tbody-detail">
                                            <tr> <td style="text-align: left;">青木 誠</td> <td>20</td><td>21</td><td>22</td><td>20</td><td>18</td><td>21</td> <td>22</td><td></td><td></td><td></td><td></td><td></td> <td>144</td><td>95.0%</td> </tr>
                                            <tr> <td style="text-align: left;">五十嵐 直人</td> <td>19</td><td>20</td><td>21</td><td>19</td><td>17</td><td>20</td> <td>20</td><td></td><td></td><td></td><td></td><td></td> <td>136</td><td>90.5%</td> </tr>
                                            <tr> <td style="text-align: left;">遠藤 雅彦</td> <td>15</td><td>16</td><td>18</td><td>15</td><td>10</td><td>14</td> <td>15</td><td></td><td></td><td></td><td></td><td></td> <td>103</td><td>68.8%</td> </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="tab-production" class="tab-content active">
                        <div class="section period-selector-section" style="margin-bottom: 1.5rem;">
                            <div class="section-content">
                                <div class="period-unit-buttons" data-target-tab="tab-production">
                                    <button class="period-unit-button" data-unit="monthly">月次</button>
                                    <button class="period-unit-button active" data-unit="yearly">年次</button>
                                    <button class="period-unit-button" data-unit="all">全期間</button>
                                </div>
                                <div class="period-main-selector">
                                    <div class="period-navigation-buttons">
                                        <button class="button button-secondary period-prev-button">‹</button>
                                    </div>
                                    <div class="period-display">
                                        <p class="period-display-label">事業年度</p>
                                        <p class="period-display-main" id="production-period-display-main">2025年度</p>
                                        <p class="period-display-sub" id="production-period-display-sub">2025年4月1日～2026年3月31日</p>
                                    </div>
                                    <div class="period-navigation-buttons">
                                        <button class="button button-secondary period-next-button">›</button>
                                    </div>
                                </div>
                                <div class="period-detail-selectors" id="production-period-details">
                                    <label for="production-year-select">年度:</label>
                                    <select id="production-year-select" class="form-control period-year-select">
                                        <option value="2025" selected>2025年度</option>
                                        <option value="2024">2024年度</option>
                                        <option value="2023">2023年度</option>
                                    </select>
                                    <label for="production-month-select" class="period-month-label" style="display: none; margin-left: 1rem;">月:</label>
                                    <select id="production-month-select" class="form-control period-month-select" style="display: none;">
                                        <option value="4">4月</option> <option value="5">5月</option> <option value="6">6月</option>
                                        <option value="7">7月</option> <option value="8">8月</option> <option value="9">9月</option>
                                        <option value="10" selected>10月</option> <option value="11">11月</option> <option value="12">12月</option>
                                        <option value="1">1月</option> <option value="2">2月</option> <option value="3">3月</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                         <div class="summary-view">
                            <div class="section">
                                <h2 class="section-title">主要指標</h2>
                                <div class="kpi-grid">
                                    <div class="kpi-card"> <h4>生産活動収入</h4> <p>3,500,000 <span class="subtext">円</span></p> </div>
                                    <div class="kpi-card"> <h4>生産活動支出</h4> <p>1,450,000 <span class="subtext">円</span></p> </div>
                                    <div class="kpi-card"> <h4>生産活動利益</h4> <p>2,050,000 <span class="subtext">円</span></p> </div>
                                    <div class="kpi-card"> <h4>工賃支払総額</h4> <p>2,032,700 <span class="subtext">円</span></p> </div>
                                </div>
                            </div>
                            <div class="section">
                                 <div class="section-header">
                                    <h2 class="section-title-in-header">生産活動収支推移 (月次)</h2>
                                    <button class="button button-secondary" onclick="showDetailView('tab-production', true)">詳細を表示</button>
                                </div>
                                <div class="section-content"> <div class="chart-placeholder">（生産活動収入・支出・利益の月次推移を示すグラフ）</div> </div>
                            </div>
                             <div class="section">
                                <h2 class="section-title">案件別 収支分析 サマリー</h2>
                                 <form class="section-content filter-form-inline" style="margin-bottom: 1.5rem;">
                                    <div class="form-group" style="flex-grow: 2;"> <label for="search-prod-project-name-summary" class="form-label">案件名/取引先</label> <input type="text" id="search-prod-project-name-summary" class="form-control" placeholder="キーワードで検索..."> </div>
                                    <div class="form-group"> <label for="filter-prod-profit-margin-summary" class="form-label">利益率</label> <select id="filter-prod-profit-margin-summary" class="form-control"> <option value="">すべて</option> <option value="high">50%以上</option> <option value="medium">20%-50%</option> <option value="low">20%未満</option> <option value="negative">赤字</option> </select> </div>
                                    <button type="button" class="button button-secondary">クリア</button>
                                </form>
                                <div class="table-wrapper">
                                    <table class="table">
                                        <thead> <tr> <th>案件名</th> <th>取引先</th> <th class="col-number">売上(円)</th> <th class="col-number">経費(円)</th> <th class="col-number">利益(円)</th> <th class="col-number">利益率(%)</th> </tr> </thead>
                                        <tbody id="production-tbody-summary">
                                            <tr class="clickable-row" data-project-name="DM封入作業" data-partner-name="株式会社A" data-profit-margin="75"> <td style="text-align: left;">DM封入作業</td> <td style="text-align: left;">株式会社A</td> <td class="col-number">1,200,000</td> <td class="col-number">300,000</td> <td class="col-number">900,000</td> <td class="col-number">75.0%</td> </tr>
                                            <tr class="clickable-row" data-project-name="部品組み立て" data-partner-name="有限会社B" data-profit-margin="43.8"> <td style="text-align: left;">部品組み立て</td> <td style="text-align: left;">有限会社B</td> <td class="col-number">800,000</td> <td class="col-number">450,000</td> <td class="col-number">350,000</td> <td class="col-number">43.8%</td> </tr>
                                            <tr class="clickable-row" data-project-name="データ入力" data-partner-name="C-Tech" data-profit-margin="90"> <td style="text-align: left;">データ入力</td> <td style="text-align: left;">C-Tech</td> <td class="col-number">500,000</td> <td class="col-number">50,000</td> <td class="col-number">450,000</td> <td class="col-number">90.0%</td> </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="detail-view">
                             <div class="section">
                                <div class="section-header">
                                     <h2 class="section-title-in-header">月次 生産活動収支 明細</h2>
                                     <button class="button button-secondary" onclick="showDetailView('tab-production', false)">サマリーへ戻る</button>
                                </div>
                                <div class="table-wrapper">
                                    <table class="table" id="production-monthly-detail-table">
                                        <thead> <tr> <th>月</th> <th class="col-number">生産活動収入(円)</th> <th class="col-number">生産活動支出(円)</th> <th class="col-number">生産活動利益(円)</th> <th class="col-number">工賃支払総額(円)</th> </tr> </thead>
                                        <tbody id="production-monthly-tbody-detail">
                                            <tr> <td>4月</td> <td class="col-number">300,000</td> <td class="col-number">120,000</td> <td class="col-number">180,000</td> <td class="col-number">280,500</td> </tr>
                                            <tr> <td>5月</td> <td class="col-number">320,000</td> <td class="col-number">130,000</td> <td class="col-number">190,000</td> <td class="col-number">282,200</td> </tr>
                                            <tr style="font-weight: bold; background-color: var(--color-hover-bg);"> <td>合計/平均</td> <td class="col-number">3,500,000</td> <td class="col-number">1,450,000</td> <td class="col-number">2,050,000</td> <td class="col-number">2,032,700</td> </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="script.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {

        const subNavContainer = document.getElementById('analytics-subnav');
        const tabContents = document.querySelectorAll('#analytics .tab-content-wrapper .tab-content');
        if (subNavContainer && tabContents.length > 0) {
             subNavContainer.addEventListener('click', (e) => {
                const navItem = e.target.closest('.sub-nav-item');
                if (!navItem || navItem.classList.contains('active')) { return; }
                e.preventDefault();
                const targetTabId = navItem.dataset.tab;
                subNavContainer.querySelectorAll('.sub-nav-item').forEach(item => { item.classList.remove('active'); });
                navItem.classList.add('active');
                tabContents.forEach(content => {
                    const isActive = content.id === targetTabId;
                    content.classList.toggle('active', isActive);
                    content.style.display = isActive ? 'block' : 'none';
                    showDetailView(content.id, false); // Switch back to summary view when changing tabs
                });
            });
             // Initialize tabs: Set default active tab
             let initialTabId = 'tab-production'; // Default
             const activeNavItem = subNavContainer.querySelector('.sub-nav-item.active');
             if(activeNavItem) initialTabId = activeNavItem.dataset.tab; // Use existing active if set in HTML

             subNavContainer.querySelectorAll('.sub-nav-item').forEach(item => item.classList.remove('active'));
             tabContents.forEach(content => { content.classList.remove('active'); content.style.display = 'none'; });

             const targetNavItem = subNavContainer.querySelector(`.sub-nav-item[data-tab="${initialTabId}"]`);
             const targetTabContent = document.getElementById(initialTabId);

             if (targetNavItem && targetTabContent) {
                 targetNavItem.classList.add('active');
                 targetTabContent.classList.add('active');
                 targetTabContent.style.display = 'block';
             } else { // Fallback if default wasn't found
                 const firstNavItem = subNavContainer.querySelector('.sub-nav-item');
                 const firstTabContent = tabContents[0];
                 if (firstNavItem && firstTabContent) {
                    firstNavItem.classList.add('active');
                    firstTabContent.classList.add('active');
                    firstTabContent.style.display = 'block';
                 }
             }
        }

        window.showDetailView = function(tabId, showDetail) {
            const tabContent = document.getElementById(tabId);
            if (!tabContent) return;
            const summaryView = tabContent.querySelector('.summary-view');
            const detailView = tabContent.querySelector('.detail-view');
            if (summaryView && detailView) {
                summaryView.style.display = showDetail ? 'none' : 'block';
                detailView.style.display = showDetail ? 'block' : 'none';

                // Update section titles in detail view when shown
                if(showDetail){
                     const periodDisplaySpan = tabContent.querySelector('.selected-period-display');
                     const detailTitle = detailView.querySelector('.section-title-in-header');
                     if(periodDisplaySpan && detailTitle){
                         const currentPeriodText = periodDisplaySpan.textContent;
                         // Remove potential old period text and append new one
                         detailTitle.textContent = detailTitle.textContent.split('(')[0].trim() + ` (${currentPeriodText})`;
                     }
                }
            }
        }

        function setupPeriodSelector(tabId) {
            const tabElement = document.getElementById(tabId);
            if (!tabElement) return;

            const unitButtonsContainer = tabElement.querySelector('.period-unit-buttons');
            const periodDetailsContainer = tabElement.querySelector('.period-detail-selectors');
            const yearSelect = tabElement.querySelector('.period-year-select');
            const monthSelect = tabElement.querySelector('.period-month-select');
            const monthLabel = tabElement.querySelector('.period-month-label');
            const prevButton = tabElement.querySelector('.period-prev-button');
            const nextButton = tabElement.querySelector('.period-next-button');
            const periodDisplayMain = tabElement.querySelector('.period-display-main');
            const periodDisplaySub = tabElement.querySelector('.period-display-sub');
            const periodDisplaySpans = tabElement.querySelectorAll('.selected-period-display'); // Used for titles
            const periodDisplayLabel = tabElement.querySelector('.period-display-label'); // Label above main display

            function getPeriodStartEnd(year, month) {
                const yearNum = parseInt(year);
                let startMonth, endMonth, startDay, endDay;

                startMonth = 4; // Assuming April start for fiscal year
                startDay = 1;
                endMonth = 3;
                endDay = 31;

                let startDate, endDate;

                if (month) { // Monthly view
                    const monthNum = parseInt(month);
                    let targetYear = yearNum;
                    if (monthNum >= 1 && monthNum <= 3) { // Jan-Mar belongs to the next calendar year for the fiscal year
                        targetYear += 1;
                    }
                    startDate = new Date(targetYear, monthNum - 1, 1);
                    endDate = new Date(targetYear, monthNum, 0); // Last day of the month
                } else { // Yearly view (Fiscal Year)
                    startDate = new Date(yearNum, startMonth - 1, startDay);
                    endDate = new Date(yearNum + 1, endMonth - 1, endDay); // Ends March 31st of next year
                }

                const formatDate = (date) => {
                    return `${date.getFullYear()}年${date.getMonth() + 1}月${date.getDate()}日`;
                }

                return {
                    start: formatDate(startDate),
                    end: formatDate(endDate)
                };
            }

            function updatePeriodDisplay() {
                const activeUnitButton = unitButtonsContainer.querySelector('.period-unit-button.active');
                let displayMain = '';
                let displaySub = '';
                let displaySpan = ''; // For titles
                let displayLabelText = '期間'; // Default label

                if (activeUnitButton) {
                    const unit = activeUnitButton.dataset.unit;
                    if (unit === 'monthly' && yearSelect && monthSelect) {
                        const yearText = yearSelect.options[yearSelect.selectedIndex]?.text || '';
                        const monthText = monthSelect.options[monthSelect.selectedIndex]?.text || '';
                        const yearValue = yearSelect.value;
                        const monthValue = monthSelect.value;
                        displayMain = `${yearText} ${monthText}`;
                        const { start, end } = getPeriodStartEnd(yearValue, monthValue);
                        displaySub = `${start}～${end}`;
                        displaySpan = displayMain;
                        displayLabelText = '対象月';
                    } else if (unit === 'yearly' && yearSelect) {
                        const yearText = yearSelect.options[yearSelect.selectedIndex]?.text || '';
                        const yearValue = yearSelect.value;
                        displayMain = yearText;
                        const { start, end } = getPeriodStartEnd(yearValue);
                        displaySub = `${start}～${end}`;
                        displaySpan = displayMain;
                         // Adjust label based on the tab's context
                         if (tabId === 'tab-welfare-service') {
                             displayLabelText = '会計年度';
                         } else {
                             displayLabelText = '事業年度'; // Default for others like finance, production
                         }
                    } else if (unit === 'all') {
                        displayMain = '全期間';
                        displaySub = '';
                        displaySpan = displayMain;
                        displayLabelText = '全期間';
                    }
                }
                if(periodDisplayMain) periodDisplayMain.textContent = displayMain;
                if(periodDisplaySub) periodDisplaySub.textContent = displaySub;
                if(periodDisplayLabel) periodDisplayLabel.textContent = displayLabelText; // Update the label text

                // Update titles that use selected-period-display span
                periodDisplaySpans.forEach(span => span.textContent = displaySpan);

                 // Also update titles in the detail view if it's currently visible
                 const detailView = tabElement.querySelector('.detail-view');
                 if(detailView && detailView.style.display !== 'none'){
                     const detailTitle = detailView.querySelector('.section-title-in-header');
                     if(detailTitle){
                         detailTitle.textContent = detailTitle.textContent.split('(')[0].trim() + ` (${displaySpan})`;
                     }
                 }
            }

            if (unitButtonsContainer) {
                unitButtonsContainer.addEventListener('click', (e) => {
                    const button = e.target.closest('.period-unit-button');
                    if (!button || button.classList.contains('active')) return;

                    unitButtonsContainer.querySelectorAll('.period-unit-button').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    const unit = button.dataset.unit;

                    // Toggle visibility of year/month selectors
                    if (periodDetailsContainer && yearSelect && monthSelect && monthLabel) {
                        yearSelect.style.display = (unit === 'monthly' || unit === 'yearly') ? '' : 'none';
                        yearSelect.previousElementSibling.style.display = yearSelect.style.display; // Show/hide "年度:" label
                        monthSelect.style.display = (unit === 'monthly') ? '' : 'none';
                        monthLabel.style.display = monthSelect.style.display; // Show/hide "月:" label
                    }
                     // Toggle visibility of navigation buttons
                     if (prevButton) prevButton.style.visibility = (unit === 'all') ? 'hidden' : 'visible';
                     if (nextButton) nextButton.style.visibility = (unit === 'all') ? 'hidden' : 'visible';

                    console.log(`Tab ${tabId} - Period unit changed to:`, unit);
                    updatePeriodDisplay(); // Update display based on new unit
                    // Potentially trigger data reload here based on the new period
                });
            }

            // Event listeners for year/month select changes
            if (yearSelect) {
                yearSelect.addEventListener('change', () => {
                     console.log(`Tab ${tabId} - Year changed to:`, yearSelect.value);
                     updatePeriodDisplay();
                     // Potentially trigger data reload
                });
            }
             if (monthSelect) {
                 monthSelect.addEventListener('change', () => {
                     console.log(`Tab ${tabId} - Month changed to:`, monthSelect.value);
                     updatePeriodDisplay();
                     // Potentially trigger data reload
                 });
             }

            // Event listeners for previous/next buttons
            if (prevButton) {
                prevButton.addEventListener('click', () => {
                    const activeUnitButton = unitButtonsContainer.querySelector('.period-unit-button.active');
                    if (!activeUnitButton) return;
                    const unit = activeUnitButton.dataset.unit;

                    if (unit === 'monthly' && monthSelect && yearSelect) {
                        let currentMonthIndex = monthSelect.selectedIndex;
                        let currentYearIndex = yearSelect.selectedIndex;
                        if (currentMonthIndex > 0) {
                            monthSelect.selectedIndex = currentMonthIndex - 1;
                        } else { // Wrap around to previous year's last month (March)
                            if (currentYearIndex + 1 < yearSelect.options.length) { // Check if there's a previous year available
                                yearSelect.selectedIndex = currentYearIndex + 1; // Move to previous year
                                monthSelect.selectedIndex = monthSelect.options.length - 1; // Set to March (last option)
                            }
                        }
                    } else if (unit === 'yearly' && yearSelect) {
                        let currentYearIndex = yearSelect.selectedIndex;
                        if (currentYearIndex + 1 < yearSelect.options.length) { // Check if there's a previous year
                             yearSelect.selectedIndex = currentYearIndex + 1; // Move to previous year
                        }
                    }
                    console.log(`Tab ${tabId} - Prev period clicked`);
                    updatePeriodDisplay();
                    // Potentially trigger data reload
                });
            }
            if (nextButton) {
                nextButton.addEventListener('click', () => {
                    const activeUnitButton = unitButtonsContainer.querySelector('.period-unit-button.active');
                    if (!activeUnitButton) return;
                    const unit = activeUnitButton.dataset.unit;

                    if (unit === 'monthly' && monthSelect && yearSelect) {
                        let currentMonthIndex = monthSelect.selectedIndex;
                        let currentYearIndex = yearSelect.selectedIndex;
                        if (currentMonthIndex < monthSelect.options.length - 1) {
                            monthSelect.selectedIndex = currentMonthIndex + 1;
                        } else { // Wrap around to next year's first month (April)
                            if (currentYearIndex > 0) { // Check if there's a next year available
                                yearSelect.selectedIndex = currentYearIndex - 1; // Move to next year
                                monthSelect.selectedIndex = 0; // Set to April (first option)
                            }
                        }
                    } else if (unit === 'yearly' && yearSelect) {
                        let currentYearIndex = yearSelect.selectedIndex;
                         if (currentYearIndex > 0) { // Check if there's a next year
                             yearSelect.selectedIndex = currentYearIndex - 1; // Move to next year
                         }
                    }
                     console.log(`Tab ${tabId} - Next period clicked`);
                     updatePeriodDisplay();
                     // Potentially trigger data reload
                 });
            }

            // Initial setup based on the default active button
            const initialActiveButton = unitButtonsContainer?.querySelector('.period-unit-button.active');
            if (initialActiveButton) {
                const initialUnit = initialActiveButton.dataset.unit;
                // Set initial visibility of selectors and buttons
                if (periodDetailsContainer && yearSelect && monthSelect && monthLabel) {
                    yearSelect.style.display = (initialUnit === 'monthly' || initialUnit === 'yearly') ? '' : 'none';
                    yearSelect.previousElementSibling.style.display = yearSelect.style.display;
                    monthSelect.style.display = (initialUnit === 'monthly') ? '' : 'none';
                    monthLabel.style.display = monthSelect.style.display;
                }
                 if (prevButton) prevButton.style.visibility = (initialUnit === 'all') ? 'hidden' : 'visible';
                 if (nextButton) nextButton.style.visibility = (initialUnit === 'all') ? 'hidden' : 'visible';
                 updatePeriodDisplay(); // Update display text
            }
        }

        // Setup selectors for each relevant tab
        setupPeriodSelector('tab-financial-overview');
        setupPeriodSelector('tab-welfare-service'); // Updated ID
        setupPeriodSelector('tab-production');


        // --- Filter Functions ---
        function filterWelfareTableSummary() { // Renamed function
             const nameInput = document.getElementById('search-welfare-member-name-summary'); // Updated ID
             const statusSelect = document.getElementById('filter-welfare-status-summary'); // Updated ID
             const tableBody = document.getElementById('welfare-tbody-summary'); // Updated ID
             if (!nameInput || !statusSelect || !tableBody) return;
             const nameFilter = nameInput.value.toLowerCase();
             const statusFilter = statusSelect.value;
             const rows = tableBody.getElementsByTagName('tr');
             Array.from(rows).forEach(row => {
                 const memberName = row.cells[0]?.textContent.toLowerCase() || '';
                 const utilRate = parseFloat(row.dataset.utilRate || 0); // Assuming data-util-rate still exists
                 const nameMatch = memberName.includes(nameFilter);
                 let statusMatch = true;
                 if(statusFilter === "high" && utilRate < 90) statusMatch = false;
                 if(statusFilter === "medium" && (utilRate < 70 || utilRate >= 90)) statusMatch = false;
                 if(statusFilter === "low" && utilRate >= 70) statusMatch = false;
                 row.style.display = (nameMatch && statusMatch) ? '' : 'none';
             });
        }
        function filterWelfareTableDetail() { // Renamed function
             const nameInput = document.getElementById('search-welfare-member-name-detail'); // Updated ID
             const tableBody = document.getElementById('welfare-monthly-tbody-detail'); // Updated ID
             if (!nameInput || !tableBody) return;
             const nameFilter = nameInput.value.toLowerCase();
             const rows = tableBody.getElementsByTagName('tr');
             Array.from(rows).forEach(row => {
                 const memberName = row.cells[0]?.textContent.toLowerCase() || '';
                 const nameMatch = memberName.includes(nameFilter);
                 row.style.display = nameMatch ? '' : 'none';
             });
        }
        function filterProductionTableSummary() {
             const keywordInput = document.getElementById('search-prod-project-name-summary');
             const marginSelect = document.getElementById('filter-prod-profit-margin-summary');
             const tableBody = document.getElementById('production-tbody-summary');
             if (!keywordInput || !marginSelect || !tableBody) return;
             const keywordFilter = keywordInput.value.toLowerCase();
             const marginFilter = marginSelect.value;
             const rows = tableBody.getElementsByTagName('tr');
             Array.from(rows).forEach(row => {
                 const projectName = row.dataset.projectName?.toLowerCase() || '';
                 const partnerName = row.dataset.partnerName?.toLowerCase() || '';
                 const profitMargin = parseFloat(row.dataset.profitMargin || 0);
                 const keywordMatch = keywordFilter === "" || projectName.includes(keywordFilter) || partnerName.includes(keywordFilter);
                 let marginMatch = true;
                 if(marginFilter === "high" && profitMargin < 50) marginMatch = false;
                 if(marginFilter === "medium" && (profitMargin < 20 || profitMargin >= 50)) marginMatch = false;
                 if(marginFilter === "low" && profitMargin >= 20) marginMatch = false;
                 if(marginFilter === "negative" && profitMargin >= 0) marginMatch = false;
                 row.style.display = (keywordMatch && marginMatch) ? '' : 'none';
             });
        }

        // --- Event Listener Setup ---
        // Welfare Service Tab Filters
        const nameWelfareInputSummary = document.getElementById('search-welfare-member-name-summary');
        const statusWelfareSelectSummary = document.getElementById('filter-welfare-status-summary');
        const clearWelfareButtonSummary = document.querySelector('#tab-welfare-service .summary-view .filter-form-inline .button-secondary');
        if(nameWelfareInputSummary) nameWelfareInputSummary.addEventListener('input', filterWelfareTableSummary);
        if(statusWelfareSelectSummary) statusWelfareSelectSummary.addEventListener('change', filterWelfareTableSummary);
        if(clearWelfareButtonSummary) { clearWelfareButtonSummary.addEventListener('click', () => { const form = clearWelfareButtonSummary.closest('form'); if(form) form.reset(); filterWelfareTableSummary(); }); }

        const nameWelfareInputDetail = document.getElementById('search-welfare-member-name-detail');
        const clearWelfareButtonDetail = document.querySelector('#tab-welfare-service .detail-view .filter-form-inline .button-secondary');
        if(nameWelfareInputDetail) nameWelfareInputDetail.addEventListener('input', filterWelfareTableDetail);
        if(clearWelfareButtonDetail) { clearWelfareButtonDetail.addEventListener('click', () => { const form = clearWelfareButtonDetail.closest('form'); if(form) form.reset(); filterWelfareTableDetail(); }); }

        // Production Tab Filters (No changes needed here)
        const keywordProdInputSummary = document.getElementById('search-prod-project-name-summary');
        const marginProdSelectSummary = document.getElementById('filter-prod-profit-margin-summary');
        const clearProdButtonSummary = document.querySelector('#tab-production .summary-view .filter-form-inline .button-secondary');
        if(keywordProdInputSummary) keywordProdInputSummary.addEventListener('input', filterProductionTableSummary);
        if(marginProdSelectSummary) marginProdSelectSummary.addEventListener('change', filterProductionTableSummary);
        if(clearProdButtonSummary) { clearProdButtonSummary.addEventListener('click', () => { const form = clearProdButtonSummary.closest('form'); if(form) form.reset(); filterProductionTableSummary(); }); }

        // --- Initial Filter Execution ---
        filterWelfareTableSummary();
        filterWelfareTableDetail();
        filterProductionTableSummary();

    });
</script>
</body>
</html>