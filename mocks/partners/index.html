<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>p2508d - 取引先管理モックアップ</title>
    <link rel="stylesheet" href="../style.css"></head>
</head>
<body>
    <div class="mockup-container">
        <header class="header">
            <div>
                <h1 class="header-logo"><a href="../dashboard/index.html">p2508d</a></h1>
            </div>
            
            <nav class="nav" id="side-nav">
                <ul class="nav-list">
                    <li><a href="../dashboard/index.html" class="nav-link">ダッシュボード</a></li>
                    <li><a href="../records/index.html" class="nav-link">日々の記録</a></li>
                    <li><a href="../members/index.html" class="nav-link">利用者支援</a></li>
                    <li><a href="../staff/index.html" class="nav-link">職員管理</a></li>
                    <li><a href="../production/index.html" class="nav-link active">生産活動</a></li>
                    <li><a href="../accounting/index.html" class="nav-link">会計管理</a></li>
                    <li><a href="../billing/index.html" class="nav-link">国保連請求</a></li>
                    <li><a href="../analytics/index.html" class="nav-link">データ分析</a></li>
                    <li><a href="../settings/index.html" class="nav-link">設定</a></li>
                </ul>
                <div class="nav-logout-section">
                    <a href="../index.html" class="nav-link">ログアウト</a>
                </div>
            </nav>
        </header>

        <main class="mockup-main">
            <div id="contacts" class="mockup-page active">
                <div class="list-page-header">
                    <h1 class="page-title">取引先一覧</h1>
                    <div>
                         <a href="../production/index.html" class="button button-secondary" style="margin-right: 0.5rem;">生産活動メニューへ</a>
                         <button class="button button-primary" onclick="alert('新規取引先作成画面へ遷移します')">＋ 新規作成</button>
                    </div>
                </div>

                <div class="section">
                    <form class="section-content filter-form">
                        <div class="form-group">
                            <label for="search-partner-name" class="form-label">会社名</label>
                            <input type="text" id="search-partner-name" class="form-control" placeholder="会社名で検索..." oninput="filterPartners()">
                        </div>
                        <div class="form-group">
                            <label for="filter-partner-type" class="form-label">種別</label>
                             <select id="filter-partner-type" class="form-control" onchange="filterPartners()">
                                <option value="">すべて</option>
                                <option value="customer">顧客</option>
                                <option value="supplier">仕入先</option>
                                <option value="outsourcer">外注先</option>
                                <option value="other">その他</option>
                            </select>
                        </div>
                        <button type="button" class="button button-secondary filter-clear-button" onclick="document.querySelector('#contacts .filter-form').reset(); filterPartners();">クリア</button>
                    </form>
                </div>
                <div class="table-wrapper" style="margin-top: 1.5rem;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>会社名</th>
                                <th>種別</th>
                                <th>電話番号</th>
                                <th>最終取引日</th>
                            </tr>
                        </thead>
                        <tbody id="partner-list-tbody">
                            <tr class="clickable-row" data-partner-type="customer" onclick="showPage('contact-detail')">
                                <td>株式会社A</td>
                                <td>顧客</td>
                                <td>03-XXXX-XXXX</td>
                                <td>2025.10.31</td>
                            </tr>
                            <tr class="clickable-row" data-partner-type="customer" onclick="showPage('contact-detail')">
                                <td>有限会社B</td>
                                <td>顧客</td>
                                <td>045-XXX-XXXX</td>
                                <td>2025.09.30</td>
                            </tr>
                            <tr class="clickable-row" data-partner-type="outsourcer" onclick="showPage('contact-detail')">
                                <td>○○印刷</td>
                                <td>外注先</td>
                                <td>03-YYYY-YYYY</td>
                                <td>2025.10.31</td>
                            </tr>
                             <tr class="clickable-row" data-partner-type="supplier customer" onclick="showPage('contact-detail')"> <td>□□商事</td>
                                <td>仕入先, 顧客</td>
                                <td>03-ZZZZ-ZZZZ</td>
                                <td>2025.11.01</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="contact-detail" class="mockup-page">
                <div class="list-page-header">
                    <h1 class="page-title">株式会社A</h1>
                    <div>
                        <button class="button button-secondary" style="margin-right: 0.5rem;" onclick="showPage('contacts')">一覧へ戻る</button>
                        <button type="button" class="button button-danger" onclick="alert('「株式会社A」のデータを削除します。よろしいですか？')">削除</button>
                    </div>
                </div>

                <div class="sub-nav">
                    <ul id="partner-detail-subnav">
                        <li><a href="#" class="sub-nav-item active" data-tab="tab-company-info">取引先情報</a></li>
                        <li><a href="#" class="sub-nav-item" data-tab="tab-trade-history">取引履歴</a></li>
                    </ul>
                </div>

                <div id="tab-company-info" class="tab-content active" style="border-top: none; padding-top: 0;">
                    <div class="section">
                         <div class="section-header">
                            <h2 class="section-title-in-header">基本情報</h2>
                            <button class="button button-primary" onclick="openModal('edit-partner-basic-modal')">編集</button>
                        </div>
                        <div class="section-content">
                            <dl class="detail-grid">
                                <dt>会社名</dt><dd>株式会社A</dd>
                                <dt>住所</dt><dd>〒XXX-XXXX 東京都...</dd>
                                <dt>電話番号</dt><dd>03-XXXX-XXXX</dd>
                                <dt>種別</dt><dd>顧客</dd>
                            </dl>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-header">
                            <h2 class="section-title-in-header">担当者一覧</h2>
                            <button class="button button-primary" onclick="openModal('edit-contact-person-modal')">＋ 担当者を追加</button>
                        </div>
                        <div class="table-wrapper">
                            <table class="table" id="contact-person-readonly-table">
                                <thead>
                                    <tr>
                                        <th>氏名</th><th>部署/役職</th><th>メールアドレス</th><th>電話番号</th>
                                    </tr>
                                </thead>
                                <tbody id="partner-contacts-tbody">
                                    <tr class="clickable-row" onclick="openModal('edit-contact-person-modal')">
                                        <td>鈴木 一郎</td>
                                        <td>営業部/部長</td>
                                        <td>suzuki@a-corp.jp</td>
                                        <td>090-XXXX-XXXX</td>
                                    </tr>
                                    <tr class="clickable-row" onclick="openModal('edit-contact-person-modal')">
                                        <td>佐藤 花子</td>
                                        <td>営業部</td>
                                        <td>sato@a-corp.jp</td>
                                        <td>090-YYYY-YYYY</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="tab-trade-history" class="tab-content" style="border-top: none; padding-top: 0;">
                    <div class="section">
                        <form class="section-content filter-form">
                            <div class="form-group">
                                <label for="search-history-project-name" class="form-label">案件名</label>
                                <input type="text" id="search-history-project-name" class="form-control" placeholder="案件名で検索...">
                            </div>
                            <div class="form-group">
                                <label for="filter-history-project-status" class="form-label">ステータス</label>
                                <select id="filter-history-project-status" class="form-control">
                                    <option value="">すべて</option>
                                    <option value="作業中">作業中</option>
                                    <option value="完了">完了</option>
                                    <option value="納品済">納品済</option>
                                    <option value="キャンセル">キャンセル</option>
                                </select>
                            </div>
                            <button type="button" class="button button-secondary filter-clear-button" onclick="document.querySelector('#tab-trade-history .filter-form').reset();">クリア</button>
                        </form>
                    </div>
                    <div class="table-wrapper" style="margin-top: 1.5rem;">
                        <table class="table">
                            <thead><tr><th>案件名</th><th>ステータス</th><th>納期</th><th>受注金額</th></tr></thead>
                            <tbody id="partner-history-tbody">
                                <tr class="clickable-row" onclick="location.href='../projects/index.html#project-detail'">
                                    <td>A社 DM封入作業</td>
                                    <td>作業中</td>
                                    <td>2025.10.31</td>
                                    <td>100,000円</td>
                                </tr>
                                <tr class="clickable-row" onclick="location.href='../projects/index.html#project-detail'">
                                    <td>(過去の案件)</td>
                                    <td>納品済み</td>
                                    <td>2025.05.20</td>
                                    <td>50,000円</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="edit-partner-basic-modal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title">取引先 基本情報編集</h2>
                        <span class="modal-close" onclick="closeModal('edit-partner-basic-modal')">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="edit-partner-name" class="form-label">会社名</label>
                            <input type="text" id="edit-partner-name" class="form-control" value="株式会社A">
                        </div>
                        <div class="form-group">
                            <label for="edit-partner-address" class="form-label">住所</label>
                            <input type="text" id="edit-partner-address" class="form-control" value="〒XXX-XXXX 東京都...">
                        </div>
                        <div class="form-group">
                            <label for="edit-partner-tel" class="form-label">電話番号</label>
                            <input type="tel" id="edit-partner-tel" class="form-control" value="03-XXXX-XXXX">
                        </div>
                        <div class="form-group">
                            <label class="form-label">種別 (複数選択可)</label>
                            <div class="checkbox-group-vertical" style="display: flex; flex-direction: column; gap: 0.5rem;">
                                <label><input type="checkbox" name="edit-partner-type" value="customer" checked> 顧客</label>
                                <label><input type="checkbox" name="edit-partner-type" value="supplier"> 仕入先</label>
                                <label><input type="checkbox" name="edit-partner-type" value="outsourcer"> 外注先</label>
                                <label><input type="checkbox" name="edit-partner-type" value="other"> その他</label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="button button-secondary" onclick="closeModal('edit-partner-basic-modal')">キャンセル</button>
                        <button type="button" class="button button-primary">保存</button>
                    </div>
                </div>
            </div>
            <div id="edit-contact-person-modal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title">担当者 編集/追加</h2>
                        <span class="modal-close" onclick="closeModal('edit-contact-person-modal')">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="contact-name" class="form-label">氏名</label>
                            <input type="text" id="contact-name" class="form-control" value="鈴木 一郎">
                        </div>
                        <div class="form-group">
                            <label for="contact-position" class="form-label">部署/役職</label>
                            <input type="text" id="contact-position" class="form-control" value="営業部/部長">
                        </div>
                        <div class="form-group">
                            <label for="contact-email" class="form-label">メールアドレス</label>
                            <input type="email" id="contact-email" class="form-control" value="suzuki@a-corp.jp">
                        </div>
                        <div class="form-group">
                            <label for="contact-tel" class="form-label">電話番号</label>
                            <input type="tel" id="contact-tel" class="form-control" value="090-XXXX-XXXX">
                        </div>
                    </div>
                    <div class="modal-footer" style="display: flex; justify-content: space-between;">
                        <button type="button" class="button button-danger" onclick="alert('この担当者を削除しますか？')">削除</button>
                        <div>
                            <button type="button" class="button button-secondary" onclick="closeModal('edit-contact-person-modal')">キャンセル</button>
                            <button type="button" class="button button-primary" style="margin-left: 0.5rem;">保存</button>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script src="../script.js"></script>
    <script>
        function filterPartners() {
            const nameInput = document.getElementById('search-partner-name');
            const typeSelect = document.getElementById('filter-partner-type');
            const tableBody = document.getElementById('partner-list-tbody');

            if (!nameInput || !typeSelect || !tableBody) {
                 console.warn("Filter elements or table body not found.");
                 return;
            }

            const nameFilter = nameInput.value.toLowerCase();
            const typeFilter = typeSelect.value;
            const rows = tableBody.getElementsByTagName('tr');

            Array.from(rows).forEach(row => {
                const companyName = row.cells[0]?.textContent.toLowerCase() || '';
                const partnerTypes = (row.dataset.partnerType || '').split(' ');
                const nameMatch = companyName.includes(nameFilter);
                const typeMatch = typeFilter === "" || partnerTypes.includes(typeFilter);

                if (nameMatch && typeMatch) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const subNavContainer = document.getElementById('partner-detail-subnav');
            const tabContents = document.querySelectorAll('#contact-detail .tab-content');

            if (subNavContainer && tabContents.length > 0) {
                subNavContainer.addEventListener('click', (e) => {
                    const navItem = e.target.closest('.sub-nav-item');
                    if (!navItem || navItem.classList.contains('active')) { return; }
                    e.preventDefault();

                    const targetTabId = navItem.dataset.tab;

                    subNavContainer.querySelectorAll('.sub-nav-item').forEach(item => { item.classList.remove('active'); });
                    navItem.classList.add('active');

                    tabContents.forEach(content => {
                        if (content.id === targetTabId) {
                            content.classList.add('active');
                        } else {
                            content.classList.remove('active');
                        }
                    });
                });
            }

            if (typeof window.filterPartners === 'function') {
                const nameInputForListener = document.getElementById('search-partner-name');
                const typeSelectForListener = document.getElementById('filter-partner-type');
                if(nameInputForListener) nameInputForListener.addEventListener('input', filterPartners);
                if(typeSelectForListener) typeSelectForListener.addEventListener('change', filterPartners);
                filterPartners();
            }
        });
    </script>

</body>
</html>